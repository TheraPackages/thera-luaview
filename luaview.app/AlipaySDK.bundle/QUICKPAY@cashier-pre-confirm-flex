{"time":"0036","tplId":"QUICKPAY@cashier-pre-confirm-flex","publishVersion":"150924","tag":"QUICKPAY","name":"cashier-pre-confirm-flex","data":{"tag":"html","children":[{"tag":"head","children":[{"tag":"meta","src":"AlipaySDK.bundle/amc.i18n","type":"i18n"},{"tag":"script","src":"AlipaySDK.bundle/amc.js"},{"tag":"link","rel":"stylesheet","href":"AlipaySDK.bundle/amc.css"},{"tag":"script","children":[{"text":"var rpc=amc.rpcData;var getTag=amc.fn.getById;var hide=amc.fn.hide;var show=amc.fn.show;var create=amc.fn.create;var isFQG=(rpc.is_fqg===\"Y\");var showAggr=(rpc.show_aggr===\"Y\");var showLogo=rpc.showLogo||false;var fingerPay=rpc.fingerPay||false;if(rpc.AndroidFingerStatus===\"1\"){fingerPay=false}var wearablePay=rpc.wearablePay;var wearablePayText=\"{{auth_bic}}\";if(!wearablePay){wearablePay=rpc.braceletPay;wearablePayText=\"{{auth_bracelet}}\"}var payAction=rpc.payAct||\"/cashier/pay\";var btnAction=rpc.btnAction;var needArrow=(rpc.channels||rpc.switchAcc);var isHuaWeiFinger=(amc.isAndroid&&fingerPay&&rpc.fpProtocolType===\"2\");var arrowPaddingRight=amc.isAndroid?19:23;var serverDefinedProtocol=rpc.protocolName&&rpc.protocolUrl;var buttonEnabled=true;function init(){var a;if(showLogo){a=amc.path+\"alipay_msp_i_logo\"}var h=amc.fn.iNav(amc.res.close,\"{{pay_detail}}\",null,amc.res.help,onClose,onHelp,a);h.id=\"iNav\";getTag(\"body\").insertBefore(h,getTag(\"iLine\"));if(getTag(\"iNavImgR\")!==undefined){getTag(\"iNavImgR\").alt=\"{{help}}\"}if(getTag(\"iNavImgM\")!==undefined){getTag(\"iNavImgM\").alt=\"{{alipay}}\"}if(rpc.navTitle&&getTag(\"iNavTxtM\")!==undefined){getTag(\"iNavTxtM\").innerText=rpc.navTitle}if(amc.isAndroid){getTag(\"loading\").src=amc.path+\"alipay_msp_indicator_white_loading\"}getTag(\"costTitle\").innerText=rpc.costTitle||\"{{need_pay}}\";var b=amc.specs.iBodyHeight-amc.specs.iNavHeight;b-=amc.isPlus?56:43;if(showAggr){if(serverDefinedProtocol){getTag(\"protocolName\").innerText=rpc.protocolName}show(\"protocol\");b-=amc.isPlus?42:32}if(isFQG){getTag(\"btnConfirm\").innerText=\"{{confirm_fqg}}\"}else{getTag(\"btnConfirm\").innerText=rpc.btnName||\"{{confirm_pay}}\"}if(rpc.product){var j=rpc.order||\"{{order_info}}\";createItem(j,rpc.product,\"product\")}if(rpc.account){var l=createItem(\"{{alipay_account}}\",rpc.account,\"account\");if(rpc.switchAcc){l.onclick=function(){hide(\"account_arrow\");show(\"account_indicatior\");var i={action:{name:\"/cashier/switchAccount\",loadtxt:\"\"}};document.asyncSubmit(i,function(m){if(m.pageloading===\"1\"){hide(\"account_arrow\");show(\"account_indicatior\")}else{if(m.pageloading===\"0\"){hide(\"account_indicatior\");show(\"account_arrow\")}}})}}}if(rpc.payTool){var l=createItem(\"{{pay_tool}}\",rpc.payTool,\"payment\");if(rpc.channels){l.onclick=function(){hide(\"payment_arrow\");show(\"payment_indicatior\");var i={action:{name:\"/cashier/switchChannel\",loadtxt:\"\"}};i.param={};i.param[\"fromCashier\"]=true;document.asyncSubmit(i,function(m){if(m.pageloading===\"1\"){show(\"payment_indicatior\");hide(\"payment_arrow\")}else{if(m.pageloading===\"0\"){hide(\"payment_indicatior\");show(\"payment_arrow\")}}})}}}var c=create(\"div\");c.style.height=\"10px\";var f=getTag(\"mainBody\");f.appendChild(c);if(needArrow){getTag(\"payMore\").style.paddingRight=amc.isAndroid?\"34px\":\"38px\"}createPropagate();for(var g=0;rpc.detail&&g<rpc.detail.length;g++){var e=rpc.detail[g];createDetail(e.info,e.price,false)}if(rpc.selDis){createDetail(\" \",\"{{sel_dis}}\",true)}if(rpc.cost){getTag(\"totalCost\").innerText=rpc.cost+\"{{money_unit}}\"}if(rpc.gonggao){var k=create(\"div\");k.className=\"amc-marquee amc-pd-lr\";var d=amc.fn.getMarquee(rpc.gonggao);k.appendChild(d);d.style.width=window.innerWidth-(amc.isPlus?40:30);getTag(\"body\").insertBefore(k,getTag(\"iNav\"));getTag(\"body\").style.height=(amc.specs.iBodyHeight+amc.specs.marqueeHeight)+\"px\"}if(isHuaWeiFinger){b-=amc.isPlus?136:105;getTag(\"scrollBox\").style.maxHeight=b+\"px\";hide(\"btnContainer\");getTag(\"androidFingerPng\").src=amc.path+\"alipay_msp_mini_finger.png\";show(\"androidFinger\");fingerPayHuawei();document.onreload=function(i){fingerPayHuawei()}}else{b-=78;getTag(\"scrollBox\").style.maxHeight=b+\"px\"}}function createItem(k,l,m){var g=getTag(\"mainBody\");var b=create(\"div\");b.className=\"amc-item amc-pd-lr\";g.appendChild(b);if(m===\"payment\"||m===\"account\"){b.className+=\" amc-press-box\"}var a=create(\"label\");a.className=\"amc-item-l-text amc-ellipsis\";a.style.maxWidth=amc.isPlus?200:150;a.innerText=k||\"\";b.appendChild(a);var e=create(\"label\");e.className=\"amc-item-r-text amc-margin-l-xs\";e.innerText=l||\"\";e.id=m;b.appendChild(e);if(m===\"product\"){if(rpc.productDetail){var d=create(\"label\");d.innerText=rpc.productDetail||\"\";d.className=\"amc-item-r-text amc-font-xs amc-margin-b-s amc-margin-t-xs\";d.style.marginLeft=amc.isPlus?45:30;b.style.cssText=\"height:auto;min-height:0px;margin-top:10px\";g.appendChild(d);if(needArrow){d.style.marginRight=arrowPaddingRight+(amc.isPlus?20:15)}else{d.style.marginRight=amc.isPlus?20:15}}}if(m===\"payment\"&&rpc.redPoint){var j=create(\"div\");j.className=\"amc-red-point\";j.style.marginLeft=\"10px\";b.appendChild(j)}if(needArrow){var f=create(\"div\");f.className=\"img-box\";f.style.width=arrowPaddingRight;b.appendChild(f);if((m===\"payment\"&&rpc.channels)||(m===\"account\"&&rpc.switchAcc)){var i=create(\"img\");i.src=\"indicatior\";hide(i);i.id=m+\"_indicatior\";f.appendChild(i);var c=create(\"img\");c.src=amc.res.arrowRight;c.id=m+\"_arrow\";f.appendChild(c)}}var h=create(\"div\");h.className=\"amc-pd-lr amc-v-box\";var n=create(\"div\");n.className=\"amc-1px-line\";h.appendChild(n);g.appendChild(h);return b}function createDetail(b,g,a){if(!g){return}var e=getTag(\"mainBody\");var d=create(\"div\");d.className=\"amc-pd-lr amc-item-detail\";e.appendChild(d);var c=create(\"label\");c.className=\"amc-detail-l-text\";c.innerText=b||\"\";d.appendChild(c);var f=create(\"label\");f.className=\"amc-detail-r-text amc-flex-1\";f.innerText=g||\"\";d.appendChild(f);if(a){d.className=\"amc-pd-lr amc-pd-t-s\";c.className=\"amc-flex-1\";f.className=\"change-discount\";f.onclick=function(){document.submit({action:{name:\"/cashier/toSelectDiscount\"}})}}else{c.style.maxWidth=amc.isPlus?220:165;c.className+=\" amc-ellipsis\"}if(needArrow){f.style.marginRight=arrowPaddingRight}}function createPropagate(){if(!rpc.propagate||!rpc.propagate[\"title\"]){return}var e=rpc.propagate;var g=e.actTitle;var d=create(\"div\",\"amc-pd-lr amc-align-center\",getTag(\"mainBody\"));d.style.cssText=\"margin-bottom: 5px\";var b=\"amc-flex-1 amc-light-color amc-font-xs \"+(g?\"amc-ellipsis\":\"amc-ellipsis-3-line\");var c=create(\"label\",b,d);c.innerText=e.title;var a=e.action?d:\"\";if(g){var f=create(\"label\",\"amc-font-xs amc-text-color-blue amc-ellipsis amc-text-right\",d);f.style.width=\"20%\";f.style.marginRight=23;f.innerText=g;a=f}if(a){a.onclick=function(){var h={action:{name:e.action,loadtxt:\"\"}};h.param=e.param;if(h.param){h.param[\"first_enter_cashier\"]=h.param[\"first_enter_cashier\"]||false}document.submit(h);if(e.dlg){setTimeout(function(){showDlg(e.dlg)},1000)}}}}function fingerPayHuawei(){var a={action:{name:rpc.authAction}};document.asyncSubmit(a,function(b){if(b.status===\"0001\"){getTag(\"fingerTextLeft\").innerText=\"{{pay_success}}\";hide(\"fingerTextRight\")}else{if(b.status===\"0002\"){getTag(\"fingerTextLeft\").innerText=\"{{auth_fingering}}\";hide(\"fingerTextRight\")}else{if(b.status===\"0003\"){getTag(\"fingerTextLeft\").innerText=\"{{paying}}\";hide(\"fingerTextRight\")}else{if(b.status===\"0004\"){gotoPwdArea()}else{if(b.status===\"0005\"){getTag(\"fingerTextLeft\").innerText=\"{{retry_finger}}\";hide(\"fingerTextRight\")}}}}}})}function showProtocol(){if(serverDefinedProtocol){document.submit({action:{name:\"loc:openweb('\"+rpc.protocolUrl+\"', '\"+(rpc.protocolTitle||\"{{serve_protocol}}\")+\"')\"}});return}var a=rpc.protocols||[{text:\"{{pcredit_protocol}}\",url:\"https://ds.alipay.com/credit/infoContract.htm\"},{text:\"{{pcredit_user_protocol}}\",url:\"https://ds.alipay.com/credit/hbContract.htm\"}];amc.fn.showProtocolList(a)}function gotoPwdArea(){var a={};a.action={name:\"loc:bnvb\"};a.param={};var b=rpc.bypass||{};a.param[\"data\"]=isObject(b.pwd)?b.pwd:{};a.param[\"data\"][\"spasswordPay\"]=rpc.spasswordPay;if(!(isHuaWeiFinger||wearablePay)){a.param[\"data\"][\"payOrder\"]=true}a.param[\"data\"][\"nextAction\"]=payAction;a.param[\"data\"][\"pwdTip\"]=rpc.pwdTip;a.param[\"data\"][\"logon_id\"]=rpc.logon_id;a.param[\"tplid\"]=\"QUICKPAY@open-pwd-check-flex\";a.param[\"tpl\"]=rpc.tpl;document.submit(a)}function onPaySuccess(){var b=getTag(\"payingText\");getTag(\"gifImg\").src=amc.res.success;b.style.opacity=0.2;var a=setTimeout(function(){b.innerText=\"{{pay_ok}}   \";b.style.opacity=1},500)}function showPayingBtn(){hide(\"confirm\");show(\"pay\");getTag(\"gifImg\").src=amc.res.loading}function showPayBtn(){show(\"confirm\");hide(\"pay\");getTag(\"gifImg\").src=\"\"}function realPay(){if(rpc.npwdPay){showPayingBtn();var a={action:{name:payAction,loadtxt:\"\"}};a.action[\"neec\"]=\"6004\";document.asyncSubmit(a,function(c){var b=c.status;if(b===\"0001\"){onPaySuccess()}else{if(b===\"0002\"||b===\"0006\"||b===\"0000\"){showPayBtn()}}})}else{if(fingerPay||wearablePay){var a={action:{name:rpc.authAction,loadtxt:\"\"}};if(wearablePay){showPayingBtn();getTag(\"payingText\").innerText=wearablePayText||\"\"}document.asyncSubmit(a,function(c){var b=c.status&&c.status.substr(-2);if(b===\"01\"){onPaySuccess()}else{if(b===\"03\"){showPayingBtn();getTag(\"payingText\").innerText=\"{{paying}}\"}else{if(b===\"09\"){document.submit({action:{name:\"loc:exit\"}})}else{if(b===\"00\"){showPayBtn();getTag(\"payingText\").innerText=\"{{paying}}\"}else{if(b===\"04\"||b===\"05\"){showPayBtn();getTag(\"payingText\").innerText=\"{{paying}}\";if(c.tip){rpc.pwdTip=c.tip}gotoPwdArea()}}}}}})}else{gotoPwdArea()}}}function onPay(){if(buttonEnabled){buttonEnabled=false;setTimeout(function(){buttonEnabled=true},600)}else{return}if(btnAction){var b={};b.action={name:btnAction,loadtxt:\"\"};document.asyncSubmit(b,function(c){amc.fn.shouldShowBtnIndicator(c,\"btnConfirm\",\"loading\")});amc.fn.shouldShowBtnIndicator({pageloading:\"1\"},\"btnConfirm\",\"loading\");return}if(rpc.chargeMsg){var a={title:\"\",message:rpc.chargeMsg,okButton:\"{{confirm_btn}}\",cancelButton:\"{{cancel}}\"};document.confirm(a,function(c){if(c.ok){realPay()}})}else{realPay()}}function onClose(){amc.fn.exit()}function onHelp(){document.submit({action:{name:\"loc:openweb('https://ds.alipay.com/help/index.htm?version=9.0', '{{help}}')\"}})}function onKeyDown(){if(event.which==4){onClose()}}function showDlg(a){if(!a||!a.btnRight||!a.dlgTxt||!a.btnLeft||!a.btnRightAction){return}getTag(\"dlgTxt\").innerText=a.dlgTxt;getTag(\"btnLeft\").innerText=a.btnLeft;getTag(\"btnRight\").innerText=a.btnRight;getTag(\"btnRight\").onclick=function(){var b={action:{name:a.btnRightAction}};document.submit(b);getTag(\"dlg\").close()};getTag(\"dlg\").showModal()}function isObject(a){return Object.prototype.toString.call(a)===\"[object Object]\"};","tag":"text"}]},{"tag":"style","children":[{"text":".img-box {\n    align-items:center;\n    justify-content:flex-end;\n}\n.text-right {\n    text-align: right;\n}\n.change-discount {\n    color: #0ae;\n    text-align: right;\n    flex: 0;\n}\n.btn-text{font-weight:bold;color:#00aaee;margin: 15px 0;}\n.btn-vertical-line{width:1px; align-self:stretch; margin: 7px 0;background-color:#e5e5e5;}","tag":"text"}]}]},{"id":"body","onload":"init()","tag":"body","children":[{"id":"iLine","tag":"div","css":"amc-1px-title-line"},{},{"id":"cashier","tag":"div","children":[{"id":"flexBody","tag":"div","children":[{"id":"scrollBox","tag":"div","children":[{},{"id":"mainBody","tag":"div","css":"amc-v-box"}],"css":"amc-scroll"},{"id":"payMore","tag":"div","children":[{"id":"costTitle","tag":"label","children":[{"text":"{{need_pay}}","tag":"text"}],"css":"amc-font-l"},{"id":"totalCost","tag":"label","css":"preconfirm-cost-text amc-ellipsis"}],"css":"amc-pd-lr amc-pd-t amc-align-center preconfirm-cost-height"}],"css":"amc-column-flex-1"},{"id":"protocol","tag":"div","children":[{"id":"agree","tag":"label","children":[{"text":"{{agree}}","tag":"text"}],"css":"amc-font-m amc-margin-r-xs"},{"id":"protocolName","tag":"label","children":[{"text":"{{serve_protocol}}","tag":"text"}],"onclick":"showProtocol()","css":"amc-font-m amc-theme-color"}],"css":"amc-pd-t amc-hidden amc-justify-center preconfirm-protocol-height"},{"id":"btnContainer","tag":"div","children":[{},{"id":"confirm","tag":"div","children":[{"id":"loading","tag":"img","src":"indicatior","css":"amc-loading-img amc-text-white-clolor amc-hidden"},{"id":"btnConfirm","tag":"label","children":[{"text":"{{confirm_pay}}","tag":"text"}],"css":"amc-pay-text "}],"onclick":"onPay()","css":"amc-primary-btn-size amc-btn-primary amc-align-center amc-justify-center"},{},{"id":"pay","tag":"div","children":[{"id":"gifImg","tag":"img","css":"amc-btn-img"},{"id":"payingText","tag":"label","children":[{"text":"{{paying}}","tag":"text"}],"css":"amc-pay-text"}],"css":"amc-primary-btn-size amc-align-center amc-justify-center amc-hidden"}],"css":"amc-pay-btn-box"},{},{"id":"androidFinger","tag":"div","children":[{"id":"androidFingerPng","tag":"img","css":"amc-finger-img-android"},{"tag":"div","children":[{"id":"fingerTextLeft","tag":"label","children":[{"text":"{{auth_finger_or}}","tag":"text"}],"css":"amc-text-slight-color amc-font-s"},{"id":"fingerTextRight","tag":"label","children":[{"text":"{{input_pwd_s}}","tag":"text"}],"onclick":"gotoPwdArea()","css":"amc-theme-color amc-font-s amc-margin-l-xs"}],"css":"amc-align-center amc-justify-center"}],"css":"amc-finger-box-android"}],"css":"amc-column-flex-1"},{"id":"dlg","tag":"dialog","children":[{"id":"dlgTxt","tag":"label","css":"amc-font-m amc-text-center amc-margin"},{"tag":"div","children":[{"tag":"div","css":"amc-adapt-line"},{"tag":"div","children":[{"id":"btnLeft","tag":"label","onclick":"getTag('dlg').close();","css":"btn-text amc-font-xxl amc-flex-1 amc-text-center"},{"tag":"div","css":"btn-vertical-line"},{"id":"btnRight","tag":"label","css":"btn-text amc-font-xxl amc-flex-1 amc-text-center"}],"css":"amc-align-center amc-justify-center"}],"css":"amc-v-box amc-justify-center amc-dlg-width"}],"css":"amc-dlg-box amc-v-box"}],"onkeydown":"onKeyDown();","css":"amc-i-body"}]},"format":"JSON","tplVersion":"5.0.4"}