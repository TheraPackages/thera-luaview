{"time":"0005","tplId":"QUICKPAY@cashier-safeprotect-pwd","publishVersion":"150924","tag":"QUICKPAY","name":"cashier-safeprotect-pwd","data":{"tag":"html","children":[{"tag":"head","children":[{"tag":"meta","src":"AlipaySDK.bundle/amc.i18n","type":"i18n"},{"tag":"link","rel":"stylesheet","href":"AlipaySDK.bundle/amc.css"},{"tag":"script","src":"AlipaySDK.bundle/amc.js"},{"tag":"script","children":[{"text":"//别名\nvar rpc = amc.rpcData;\nvar getTag = amc.fn.getById;\nvar hide = amc.fn.hide;\nvar show = amc.fn.show;\n\nvar loadingBlueGif = amc.path + 'alipay_msp_loading_blue.gif';\nvar successGif = amc.path + 'alipay_msp_success_blue.gif';\n\n// 是否使用6位支付密码\nvar spasswordPay = rpc.spasswordPay;\n// 按钮文案初始化\nvar successTxt = rpc.successText || '校验成功';\nvar payTxt = rpc.doingText || '正在校验...';\nvar btnText = rpc.btnText || '确定';\n\nvar tips = rpc.tips;\n\nvar gifTag;\nvar backAction = '';\n\n/*\n * 初始化\n */\nfunction init() {\n    var lImg = rpc.useBackImg ? amc.res.arrowLeft: amc.res.close;\n    \n    if(rpc.backAction){\n        backAction = rpc.backAction;\n    } else {\n        backAction = 'loc:exit';\n    }\n\n    var iNav = amc.fn.iNav(lImg, '{{input_pwd}}', null, null, onBack, null);\n    getTag('body').insertBefore(iNav,getTag('iLine'));\n    \n    gifTag = getTag('pwdLoadGif');\n    \n    getTag('loadTxt').innerText = payTxt;\n    getTag('payBtn').innerText = btnText;\n    \n    showPwdInput();\n}\n\nfunction showPwdInput() {\n    //提示信息\n    if(tips) {\n        \n        show('tips');\n        getTag('tips').innerText = tips;\n    } else {\n        hide('tips');\n    }\n\n    var pwdBox = getTag('password');\n    var spwdBox = getTag('spassword');\n    \n    if (spasswordPay) {\n        hide(pwdBox);\n        show(spwdBox);\n        getTag('spwd').focus();\n    } else {\n        hide(spwdBox);\n        show(pwdBox);\n        getTag('pwd').focus();\n    }\n}\n\n// 输入密码后，提交支付\nfunction submitPay(pwd, obj) {\n    hide('pwdBox');\n    hide('tips'); //支付时隐藏文案 @麓辰\n    show('pwdLoad');\n    gifTag.src = loadingBlueGif;\n    pwd.blur();\n \n \n    obj['action'] = rpc['action'] || {};\n    obj['action']['neec'] = '6004';\n    \n    obj['action']['loadtxt'] = '';\n    obj['action']['params'] = rpc.params;   // 透传参数\n    \n    document.asyncSubmit(obj, function(data) {\n        // 支付成功\n        if (data['status'] === '0001') {\n            getTag('loadTxt').innerText = data['successText'] || successTxt;\n            gifTag.src = successGif;\n        } else if (data['status'] === '0002') {\n            // 密码错误，不能继续输入\n            resetPwd(true);\n        } else if (data['status'] === '0000') {\n            // 密码错误继续输入\n            resetPwd(false);\n        }\n    });\n}\n\n//### 密码出错后的重置操作\nfunction resetPwd(isForgetPwd){\n    gifTag.src = '';\n    hide('pwdLoad');\n    show('pwdBox');\n    \n    getTag('payBtn').disabled = true;\n    var pwd = spasswordPay ? getTag('spwd'): getTag('pwd');\n\n    pwd.value = '';\n    if (!spasswordPay){\n        onPwdInput();\n    }\n    \n    //IOS 忘记密码，不会再回到页面，因此键盘不能弹出，否则会是闪退效果.\n    if(!isForgetPwd || amc.isAndroid){\n        pwd.focus();\n    }\n    \n    if(isForgetPwd) {\n        forgetPwd();\n    }\n}\n\n// 普通密码输入响应\nfunction onPwdInput(){\n    var pwd = getTag('pwd');\n    if (pwd.value.length > 0){\n        getTag('payBtn').disabled = false;\n        getTag('payBtn').style.color = '#0ae';\n    } else{\n        getTag('payBtn').disabled = true;\n        getTag('payBtn').style.color = '#d2d2d2';\n    }\n}\n\n// 简单6位密码输入事件\nfunction onSpwdInput() {\n    var spwd = getTag('spwd');\n    if (spwd.value.length >= 6) {\n        var svalue = spwd.encryptValue || spwd.value || '';\n        \n        var submitObj = {'spwd':svalue};\n        submitObj['encryptType'] = 'RSA';\n        \n        var obj = {};\n        obj['param'] = submitObj;\n        \n        submitPay(spwd, obj);\n    }\n}\n\n// 普通密码付款按钮事件\nfunction onPasswordPay() {\n    var pwd = getTag('pwd');\n    if (pwd.value.length > 0) {\n        var submitObj = {};\n        submitObj['pwd'] = pwd.encryptValue || pwd.value || '';\n        submitObj['encryptType'] = 'RSA';\n        \n        var obj = {};\n        obj['param'] = submitObj;\n        \n        submitPay(pwd, obj);\n    }\n}\n\n// 根据业务类型来确定是退出还是后退\nfunction onBack() {\n    document.submit({'action':{'name':backAction}});\n}\n\n\nfunction forgetPwd() {\n    var loginId = '';\n    if(rpc.logon_id) {\n        loginId = '&loginId=' + rpc.logon_id;\n    }\n    var url = 'alipays://platformapi/startApp?appId=20000013&pwdType=phonePassword' + loginId;\n    \n    document.submit({'action':{'name':\"loc:openurl('\" + url +  \"','0')\"}});\n}\n\nfunction onKeyDown()\n{\n    if(event.which == 4){\n        onBack();\n    }\n}","tag":"text"}]},{"tag":"style","children":[{"text":".pwd-btn-text {\n    color:#d2d2d2;\n}","tag":"text"}]}]},{"id":"body","onload":"init()","tag":"body","children":[{"id":"iLine","tag":"div","css":"amc-1px-title-line"},{"id":"mainBody","tag":"div","children":[{},{"id":"tipsBox","tag":"div","children":[{"id":"tips","tag":"label","css":"amc-flex-1 amc-text-center amc-font-m"}],"css":"amc-flex-center amc-pd-lr amc-pd-t"},{"id":"pwdBox","tag":"div","children":[{},{"id":"password","tag":"div","children":[{"tag":"div","children":[{},{"tag":"div","children":[{"tag":"div","css":"amc-abs-space-h-m"},{"id":"pwd","placeholder":"{{alipaypwd}}","tag":"input","value":"","type":"paypwd","css":"amc-input amc-spwd-height","oninput":"onPwdInput()"}],"css":"amc-cell-m-box"},{"tag":"div","css":"amc-cell-v-line"},{},{"tag":"div","children":[{"id":"payBtn","tag":"label","children":[{"text":"{{pay}}","tag":"text"}],"css":"pwd-btn-text amc-font-xxl","disabled":"disabled"}],"onclick":"onPasswordPay()","css":"amc-flex-center amc-pwd-check-btn-w"}],"css":"amc-spwd-box"}],"css":"amc-pd-t"},{},{"id":"spassword","tag":"div","children":[{"id":"spwd","tag":"input","value":"","type":"payspwd","css":"amc-pwd-input amc-spwd-height","oninput":"onSpwdInput()"}],"css":"amc-spwd-box amc-margin-t amc-hidden"},{"tag":"div","children":[{"id":"leftMargin","tag":"div","css":"amc-flex-1"},{},{"tag":"div","children":[{"tag":"label","children":[{"text":"{{forget_pwd}}","tag":"text"}],"onclick":"forgetPwd()","css":"amc-theme-color amc-font-m"}],"css":"amc-pd-t-s"}]}],"css":"amc-pd-lr amc-v-box"},{},{"id":"pwdLoad","tag":"div","children":[{"tag":"div","css":"amc-flex-space-1"},{"id":"pwdLoadGif","tag":"img","css":"amc-load-img"},{"tag":"div","children":[{"id":"loadTxt","tag":"label","children":[{"text":"{{paying}}","tag":"text"}],"css":"amc-font-l-white"}],"css":"amc-justify-center amc-pd-t-l"},{"tag":"div","css":"amc-flex-space-2"}],"css":"amc-loading-box"}],"css":"amc-v-box amc-flex-1"}],"onkeydown":"onKeyDown()","css":"amc-i-body"}]},"format":"JSON","tplVersion":"5.0.2"}