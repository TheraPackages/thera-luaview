{"time":"0006","tplId":"QUICKPAY@cashier-setspwd-flex","publishVersion":"150924","tag":"QUICKPAY","name":"cashier-setspwd-flex","data":{"tag":"html","children":[{"tag":"head","children":[{"tag":"script","src":"cashier-setspwd-flex.js"},{"tag":"link","rel":"stylesheet","href":"AlipaySDK.bundle/amc.css"},{"tag":"meta","src":"AlipaySDK.bundle/amc.i18n","type":"i18n"},{"tag":"script","src":"AlipaySDK.bundle/amc.js"},{"tag":"script","children":[{"text":"var getTag=amc.fn.getById;var hide=amc.fn.hide;var show=amc.fn.show;var tipsSet=\"{{spwd_pay}}\";var tipsRepeat=\"{{confirm_again}}\";var actionSet=\"\";var actionRepeat=\"\";var protocols=[{text:\"{{alipay_serve_protocol}}\",url:\"https://mgw.alipay.com/agreement.htm\"},{text:\"{{baoxian_protocol}}\",url:\"https://ds.alipay.com/baoxian/zhxprotocol.htm\"}];var canGiveInsurance=false;var showServiceProtocol=true;var protocolCount=0;var protocolIndex=0;var checkbox=null;var checkLabel=null;function init(){var a=amc.fn.getNav(amc.res.navBack,\"{{return}}\",\"{{set_pwd}}\",null,null,onBack,null);getTag(\"body\").insertBefore(a,getTag(\"mainBody\"));if(amc.isAndroid){getTag(\"loading\").src=amc.path+\"alipay_msp_indicator_white_loading\"}if(amc.rpcData.setSpwdType===\"quser\"){actionSet=\"/cashier/setSpwd\";actionRepeat=\"/cashier/saveSpwd\"}else{if(amc.rpcData.setSpwdType===\"complete\"){tipsSet=\"{{pay_spwd}}\";actionSet=\"/complete/spwd\";actionRepeat=\"/complete/savespwd\";showServiceProtocol=false}}initCheckBox();getTag(\"tips\").innerText=tipsSet;getTag(\"spwd\").focus()}function onSpwdInput(){resetErrMsg();var a=getTag(\"spwd\");if(a.value.length>=6){onFirstInput()}}function onSpwdRepeatInput(){resetErrMsg();var a=getTag(\"spwdRepeat\");getTag(\"nextBtn\").disabled=!(a.value.length>=6)}function handleResponse(b){var a=(b.recommendNoPwd===\"true\");checkbox.checked=(b.selectOpenNoPwd===\"true\");canGiveInsurance=(b.canGiveBaoxian===\"true\");checkLabel.innerText=canGiveInsurance?\"{{can_insuranced}}\":\"{{insuranced}}\";if(a){show(\"checkArea\")}else{hide(\"checkArea\")}protocolCount=0;protocolIndex=0;if(showServiceProtocol){protocolCount++;protocolIndex=0}if(a&&canGiveInsurance){protocolCount++;protocolIndex=1}show(\"agreeProtocol\");if(protocolCount===1){getTag(\"protocol\").innerText=protocols[protocolIndex][\"text\"]||\"\";if(protocolIndex===1){getTag(\"agree\").innerText=\"{{look}}\"}}else{if(protocolCount===2){getTag(\"protocol\").innerText=\"{{user_agreement}}\"}else{hide(\"agreeProtocol\")}}}function onFirstInput(){var c={action:{name:actionSet}};var b=getTag(\"spwd\").encryptValue||getTag(\"spwd\").value;var a={spwd:b};a.encryptType=\"RSA\";c.param=a;document.asyncSubmit(c,function(d){if(d.status===\"0001\"){handleResponse(d);hide(\"spwdBox\");hide(\"firstPage\");show(\"spwdRepeatBox\");show(\"secondPage\");getTag(\"tips\").innerText=tipsRepeat;getTag(\"spwdRepeat\").value=\"\";getTag(\"nextBtn\").disabled=true;getTag(\"spwdRepeat\").focus()}else{if(d.status===\"0000\"){getTag(\"spwd\").disabled=false;getTag(\"spwd\").value=\"\";if(d.errMsg){resetErrMsg(d.errMsg)}getTag(\"spwd\").focus()}}})}function onSubmit(){var d={action:{name:actionRepeat}};var c=getTag(\"spwdRepeat\");var b=c.encryptValue||c.value;var a={spwd:b};a.encryptType=\"RSA\";a.openNopwdSwitch=(checkbox&&(checkbox.checked===true||checkbox.checked===\"1\"));a.openBaoxian=canGiveInsurance;d.param=a;document.asyncSubmit(d,function(e){if(e.status===\"0000\"){if(e.errMsg){resetErrMsg(e.errMsg)}againOnce()}amc.fn.shouldShowBtnIndicator(e,\"nextBtn\",\"loading\")});amc.fn.shouldShowBtnIndicator({pageloading:\"1\"},\"nextBtn\",\"loading\")}function againOnce(){getTag(\"spwd\").value=\"\";show(\"spwdBox\");hide(\"spwdRepeatBox\");hide(\"secondPage\");show(\"firstPage\");getTag(\"tips\").innerText=tipsSet;getTag(\"spwd\").focus()}function showProtocol(){if(protocolCount===1){document.submit({action:{name:\"loc:openweb('\"+protocols[protocolIndex][\"url\"]+\"','\"+protocols[protocolIndex][\"text\"]+\"')\"}});return}var b=new Array();for(var a=0;a<protocols.length;a++){b.push(protocols[a][\"text\"])}document.actionSheet({btns:b,cancelBtn:\"{{cancel}}\"},function(c){document.submit({action:{name:\"loc:openweb('\"+protocols[c.index][\"url\"]+\"','\"+protocols[c.index][\"text\"]+\"')\"}})})}function resetErrMsg(a){a=a||\"\";if(a){show(\"errMsgBox\")}else{hide(\"errMsgBox\")}getTag(\"errMsg\").innerText=a||\"\"}function initCheckBox(){var a=getTag(\"checkArea\");checkbox=amc.fn.create(\"input\");a.appendChild(checkbox);checkbox.type=\"checkbox\";checkbox.className=\"amc-checkbox amc-margin-r-s\";checkbox.checked=false;checkLabel=amc.fn.create(\"label\");checkLabel.className=\"amc-font-m amc-flex-1\";var b=amc.fn.create(\"div\");b.style.cssText=\"flex:1.0;\";b.appendChild(checkLabel);a.appendChild(b)}function onBack(){if(getTag(\"spwd\").style.display===\"none\"){againOnce()}else{amc.fn.exitConfirm()}}function onKeyDown(){if(event.which==4){onBack()}};","tag":"text"}]},{"tag":"style","children":[{"text":".err-msg-box {\n    justify-content:center;\n    display:none;\n}\n.err-msg-text {\n    color:#f4333c;\n}\n.err-info-text {\n    color: #a5a5a5;\n}\n.check-area-box {\n    align-items: flex-start;\n}\n.amc-nav-r-box {\n    display: none;\n}","tag":"text"}]}]},{"id":"body","onload":"init()","tag":"body","children":[{"id":"mainBody","tag":"div","children":[{"tag":"div","children":[{"id":"tips","tag":"label","css":"amc-font-m amc-text-center amc-flex-1"}],"css":"amc-flex-center"},{"tag":"div","children":[{"id":"spwdBox","tag":"div","children":[{"id":"spwd","tag":"input","value":"","type":"payspwd","css":"amc-pwd-input","oninput":"onSpwdInput()"}],"css":"amc-spwd-box"},{"id":"spwdRepeatBox","tag":"div","children":[{"id":"spwdRepeat","tag":"input","value":"","type":"payspwd","css":"amc-pwd-input","oninput":"onSpwdRepeatInput()"}],"css":"amc-spwd-box amc-hidden"}],"css":"amc-v-box amc-pd-tb"},{"id":"errMsgBox","tag":"div","children":[{"id":"errMsg","tag":"label","children":[{"text":"{{pwd-error-repeat}}","tag":"text"}],"css":"err-msg-text"}],"css":"err-msg-box amc-pd-b"},{"id":"firstPage","tag":"label","children":[{"text":"{{pwd-notice}}","tag":"text"}],"css":"err-info-text amc-font-m amc-margin-l-xs"},{"id":"secondPage","tag":"div","children":[{"tag":"div","children":[{"id":"checkArea","tag":"div","css":"check-area-box amc-pd-b"},{"id":"agreeProtocol","tag":"div","children":[{"id":"agree","tag":"label","children":[{"text":"{{agree}}","tag":"text"}],"css":"amc-font-m amc-margin-r-xs"},{"id":"protocol","tag":"label","children":[{"text":"{{alipay_serve_protocol}}","tag":"text"}],"onclick":"showProtocol()","css":"amc-font-m amc-theme-color"}],"css":"agree-box amc-margin-b-l"}],"css":"amc-v-box"},{"tag":"div","children":[{"id":"loading","tag":"img","src":"indicatior","css":"amc-loading-img amc-text-white-clolor amc-hidden"},{"id":"nextBtn","tag":"button","children":[{"text":"{{next}}","tag":"text"}],"onclick":"onSubmit()","css":"amc-btn-primary","disabled":"true"}],"css":"amc-align-center amc-justify-center amc-btn-primary"}],"css":"amc-v-box amc-hidden"}],"css":"amc-main amc-pd-lr"}],"onkeydown":"onKeyDown();","css":"amc-body"}]},"format":"JSON","tplVersion":"5.0.4"}