{"time":"0107","tplId":"QUICKPAY@open-account-auth-flex","publishVersion":"150924","tag":"QUICKPAY","name":"open-account-auth-flex","data":{"tag":"html","children":[{"tag":"head","children":[{"tag":"meta","src":"AlipaySDK.bundle/amc.i18n","type":"i18n"},{"tag":"script","src":"AlipaySDK.bundle/amc.js"},{"tag":"link","rel":"stylesheet","href":"AlipaySDK.bundle/amc.css"},{"tag":"script","children":[{"text":"var create = amc.fn.create;\nvar getTag = amc.fn.getById;\nvar checkedPng = amc.path + 'alipay_msp_checked';\nvar logoPng = amc.rpcData.params.logo_url || '';\nvar authTitle = amc.rpcData.params.auth_title || '';\nvar optionTitle = amc.rpcData.params.auth_option_title || '';\nvar authOptionList = amc.rpcData.params.auth_option_list || '';\nvar authType = amc.rpcData.params.auth_type || '';\nvar optionRight = '';\nvar mobileMask = amc.rpcData.hidden_logon_id || '';\nvar checkboxs=[];\nvar protocols=[];\nvar authTypeText = '{{auth}}';\nvar getTag = amc.fn.getById;\nvar canAuth = true;\n//### 初始化\nfunction init() {\n    if (authType == 'LOGIN'){\n        authTypeText = '{{login}}';\n    }\n\n    var mText = '{{alipay}}' + authTypeText;\n    var nav = amc.fn.navBack(false,mText,null,null,onBack,null);\n    getTag('body').insertBefore(nav,getTag('topBody'));\n    initText();\n    getTag('logo').src = logoPng;\n\tgetTag('authTitle').innerText = authTitle;\n    getTag('mobileMask').innerText = mobileMask;\n\tgetTag('optionTitle').innerText = optionTitle;\n\n    var rightBox = getTag('rights');\n    var textList = amc.rpcData.params.auth_text_list;\n    if (textList){\n        var tmpList = [];\n\n        for(var i = 0; i < textList.length && i < 3; i++) {\n            tmpList[tmpList.length] = textList[i];\n        }\n\n        for(var i = 0; i < tmpList.length; i++) {\n            var label = create('label');\n            label.className = 'amc-margin-b-ss amc-font-s amc-text-light-color amc-ellipsis';\n            label.innerText = (i+1) + '. ' + tmpList[i];\n            rightBox.appendChild(label);\n        }\n    }\n\n\tcheckboxs = getOptionList(authOptionList,'TEXT');\n\tif(checkboxs && checkboxs.length > 0){\n        for(var idx in checkboxs){\n            initCheckbox(checkboxs[idx]);\n        }\n\t}\n\tprotocols = getOptionList(authOptionList,'URL');\n    if (protocols.length == 0){\n        getTag('protocolArea').style.display = 'none';\n    }\n}\n\n//### 文案初始化\nfunction initText(){\n    getTag('confirmBtn').innerText = '{{confirm_btn}}' + authTypeText;\n    getTag('tipText').innerText = '{{use_alipay_account}}' + authTypeText;\n}\n\n//### 获取选项列表\nfunction getOptionList(optionList,key){\n\tvar list = [];\n\tfor(var idx in optionList){\n\t\tif(optionList[idx].type==key){\n\t\t\tlist.push(optionList[idx]);\n\t\t}\n\t}\n\treturn list;\n}\n\n//### 初始化checkbox\nfunction initCheckbox(checkitem){\n    var checkArea = getTag('checkArea');\n    var checkCell = create('div');\n    checkCell.className = 'amc-align-center amc-margin-b-s';\n    \n    var checkbox;\n    if (checkitem.forced){\n        checkbox = create('img');\n        checkbox.className = 'amc-check-img';\n        checkbox.src = checkedPng;\n        checkCell.appendChild(checkbox);\n    } else {\n        checkbox = create('input');\n        checkCell.appendChild(checkbox);\n        checkbox.type='checkbox';\n        checkbox.className = 'amc-checkbox';\n        checkbox.checked = checkitem.checked;\n    }\n    checkbox.className = checkbox.className + ' amc-margin-r-xs';\n    \n    checklabel = create('label');\n    checklabel.innerText = checkitem.optionText;\n    checklabel.className = 'amc-font-m';\n    checkCell.appendChild(checklabel);\n    \n    checkArea.appendChild(checkCell);\n    checkitem['_checkbox'] = checkbox;\n}\n\n//### 打开协议\nfunction showProtocol() {\n    for (var i = 0; i < protocols.length; i++) {\n        protocols[i]['text'] = '{{serve_protocol}}';\n        protocols[i]['url'] = protocols[i]['optionText'];\n    }\n    amc.fn.showProtocolList(protocols);\n}\n\n//### 验密请求\nfunction onSubmit(){\n    if (!canAuth){\n        return;\n    }\n\tvar agrees = [];\n\tfor(var i=0;i<checkboxs.length;i++){\n        if (checkboxs[i].forced){\n            agrees.push(checkboxs[i].optionKey);\n        } else if(checkboxs[i]['_checkbox'].checked === true ||  checkboxs[i]['_checkbox'].checked === '1'){\n            agrees.push(checkboxs[i].optionKey);\n        }\n\t}\n\tagrees.push('PROTOCOL')\n    var obj = {\n\t\t'param':{'agree':agrees},\n\t\t'action':{\n\t\t\t'name':'/account/auth','loadtxt':''\n\t\t}\n\t};\n    amc.fn.playGif(getTag('gifImg'),amc.res.loading);\n    getTag('btnText').innerText = '{{confirming_upgrade}}';\n    document.submit(obj);\n    setTimeout(resetBtn,3000);\n    canAuth = false;\n}\n\n//### 充值按钮\nfunction resetBtn(){\n    amc.fn.playGif(getTag('gifImg'),'');\n    getTag('btnText').innerText = '{{confirm_btn}}' + authTypeText;\n    canAuth = true;\n}\n\n//### Android硬返回\nfunction onKeyDown(){\n    if(event.which == 4){\n        onBack();\n    }\n}\n\n//### 退出\nfunction onBack() {\n    amc.fn.exitConfirm('{{confirm_exit}}');\n}\n\n//### 更换账户\nfunction onSwitchAccount(){\n    var obj = {'action':{'name':'/cashier/switchAccount'}};\n    document.submit(obj);\n}","tag":"text"}]},{"tag":"style","children":[{"text":".bold-text{font-weight:bold}\n.amc-nav-r-box {}\n.amc-nav-l-text {color:#fff;font-size:14px;text-align:left;}","tag":"text"}]}]},{"id":"body","onload":"init()","tag":"body","children":[{"id":"topBody","tag":"div","children":[{"tag":"div","children":[{"id":"logo","tag":"img","css":"open-auth-img"}],"css":"amc-pd-tb"},{"tag":"div","children":[{"id":"authTitle","tag":"label","css":"amc-font-xl"}],"css":"amc-pd-b"},{"tag":"div","css":"amc-abs-space-v-s"},{"id":"tipText","tag":"label","children":[{"text":"{{use_alipay_auth}}","tag":"text"}],"css":"amc-font-xl"},{"tag":"div","css":"amc-abs-space-v-ss"},{"tag":"div","children":[{"id":"mobileMask","tag":"label","css":"amc-font-xl amc-margin-r-xs"},{"id":"changeBtn","tag":"label","children":[{"text":"{{sel}}","tag":"text"}],"onclick":"onSwitchAccount()","css":"amc-font-xl amc-theme-color"}],"css":"amc-pd-b"},{"tag":"div","css":"amc-1px-line"}],"css":"amc-pd-t amc-v-box amc-align-center amc-bg-white"},{"tag":"div","children":[{"id":"tipArea","tag":"div","children":[{"tag":"div","css":"amc-abs-space-v-l"},{"id":"optionTitle","tag":"label","css":"amc-margin-b-s amc-font-xl bold-text"},{"id":"rights","tag":"div","css":"amc-v-box"}],"css":"amc-pd-lr amc-v-box"},{"tag":"div","css":"amc-abs-space-v-s"},{"id":"checkArea","tag":"div","css":"amc-pd-lr amc-v-box"},{"tag":"div","css":"amc-abs-space-v-s"},{"id":"container","tag":"div","children":[{"id":"confirmBtn","tag":"div","children":[{"id":"gifImg","tag":"img","css":"amc-btn-img amc-hidden"},{"id":"btnText","tag":"label","children":[{"text":"{{confirm_auth}}","tag":"text"}],"css":"amc-btn-text-color amc-font-super-l"}],"onclick":"onSubmit()","css":"amc-btn-primary amc-justify-center amc-align-center"}],"css":"amc-pd-lr amc-pd-b"},{"id":"protocolArea","tag":"div","children":[{"id":"agree","tag":"label","children":[{"text":"{{agree}}","tag":"text"}],"css":"amc-font-m amc-margin-r-xs"},{"id":"protocol","tag":"label","children":[{"text":"{{serve_protocol}}","tag":"text"}],"onclick":"showProtocol()","css":"amc-font-m amc-theme-color"}],"css":"amc-pd-lr amc-pd-b"}],"css":"amc-v-box"}],"onkeydown":"onKeyDown()","css":"amc-body"}]},"format":"JSON","tplVersion":"5.0.2"}